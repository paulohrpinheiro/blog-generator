#!/usr/bin/env ruby

require 'optparse'
require 'fileutils'

require 'gerablog'

options = {}

optparse = OptionParser.new do |opts|
  opts.banner = 'Usage: optparse [options]'

  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end

  options[:new] = nil
  opts.on('-n', '--new FILENAME', 'Create a new project.') do |value|
    options[:new] = value
  end

  options[:generate] = nil
  opts.on('-g', '--generate FILENAME', 'Generate the static blog.') do |value|
    options[:generate] = value
  end
end

optparse.parse!

if options[:generate]
  gb = GeraBlog::Blog.new
  gb.load_config options[:generate] unless options[:generate].nil?
  gb.save
elsif options[:new]
  gb = GeraBlog::Blog.new options[:new]
  gb.config['dir'].values.map { |dir| GeraBlog.create_dir(dir) }
  GeraBlog.make_dest_dir(
    File.join(__dir__, '..', 'assets'),
    gb.config['dir']['root'],
  )

  GeraBlog.make_dest_dir(
    File.join(__dir__, '..', 'templates'),
    gb.config['dir']['root'],
  )

  file = File.open(File.join(gb.config['dir']['root'], 'gerablog.conf'), 'w')
  gb.config.write(file)
else
  puts optparse.parse! %w(--help)
end
